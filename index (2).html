<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>MineAI Mobile</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<style>
html,body{margin:0;width:100%;height:100%;overflow:hidden;background:#87ceeb;touch-action:none}
canvas{display:block}

/* CRUCETA CENTRAL */
#crosshair {
 position: fixed; left: 50%; top: 50%; width: 20px; height: 20px;
 transform: translate(-50%, -50%); pointer-events: none; z-index: 100;
 mix-blend-mode: difference;
}
#crosshair::before, #crosshair::after { content: ""; position: absolute; background: #ffffff; }
#crosshair::before { left: 9px; top: 0; width: 2px; height: 20px; }
#crosshair::after { top: 9px; left: 0; width: 20px; height: 2px; }

/* D-PAD MOVIMIENTO (SEPARADO) */
#dpad {
 position: fixed; bottom: 40px; left: 30px; z-index: 20;
 display: flex; flex-direction: column; align-items: center;
}
.dpad-row { 
    display: flex; 
    gap: 65px; /* Aumentado para separar izquierda de derecha */
}
.m-btn {
 width: 60px; height: 60px; background: rgba(0, 0, 0, 0.3);
 border: 2px solid #fff; border-radius: 12px; color: white;
 font-size: 22px; display: flex; align-items: center; justify-content: center;
 user-select: none; -webkit-tap-highlight-color: transparent;
}
.m-btn:active { background: rgba(255, 255, 255, 0.4); }

/* Ajuste de posición para forma de cruz */
#btn-fwd { margin-bottom: 10px; }
#btn-back { margin-top: 10px; }

/* BOTONES ACCIÓN */
.btn{
 position:fixed;right:20px;width:65px;height:65px;
 border-radius:14px;font-size:24px;z-index:10;
 border: 2px solid rgba(255,255,255,0.5);
}
#break{bottom:110px;background:#c0392b;color:#fff}
#place{bottom:190px;background:#27ae60;color:#fff}

/* HOTBAR */
#hotbar{
 position:fixed;bottom:20px;left:50%;
 transform:translateX(-50%);
 display:flex;gap:8px;z-index:10;
 background: rgba(0,0,0,0.5); padding: 5px; border-radius: 8px;
}
.slot{
 width:48px;height:48px;border:2px solid #444;border-radius:6px;
 color: white; display: flex; align-items: center; justify-content: center;
 font-family: monospace;
}
.slot.active{border:3px solid white; background: rgba(255,255,255,0.2);}
</style>
</head>

<body>
<div id="crosshair"></div>

<div id="dpad">
    <div class="dpad-row"><button id="btn-fwd" class="m-btn">▲</button></div>
    <div class="dpad-row">
        <button id="btn-left" class="m-btn">◀</button>
        <button id="btn-right" class="m-btn">▶</button>
    </div>
    <div class="dpad-row"><button id="btn-back" class="m-btn">▼</button></div>
</div>

<button id="break" class="btn">⛏</button>
<button id="place" class="btn">⬜</button>
<div id="hotbar"></div>

<script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
<script>
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87ceeb);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
document.body.appendChild(renderer.domElement);

window.addEventListener("resize",()=>{
 camera.aspect = window.innerWidth/window.innerHeight;
 camera.updateProjectionMatrix();
 renderer.setSize(window.innerWidth, window.innerHeight);
});

scene.add(new THREE.AmbientLight(0xffffff,0.6));
const sun = new THREE.DirectionalLight(0xffffff,0.6);
sun.position.set(50,100,50);
scene.add(sun);

const loader = new THREE.TextureLoader();
loader.crossOrigin = "";
const textures = {};
let loadedCount = 0;

function loadTex(name,url){
 loader.load(url,t=>{
   t.magFilter = THREE.NearestFilter;
   t.minFilter = THREE.NearestFilter;
   textures[name]=t;
   loadedCount++;
   if(loadedCount === 4) { createBlocks(); loop(); }
 });
}

loadTex("grassTop","https://raw.githubusercontent.com/facumerag-ctrl/Mineai/main/grass_top.png");
loadTex("grassSide","https://raw.githubusercontent.com/facumerag-ctrl/Mineai/main/grass_side.png");
loadTex("dirt","https://raw.githubusercontent.com/facumerag-ctrl/Mineai/main/dirt.png");
loadTex("stone","https://raw.githubusercontent.com/facumerag-ctrl/Mineai/main/stone.png");

const blocks = [];
const geo = new THREE.BoxGeometry(1,1,1);

function grassMaterial(){
 return [
   new THREE.MeshLambertMaterial({map:textures.grassSide}),
   new THREE.MeshLambertMaterial({map:textures.grassSide}),
   new THREE.MeshLambertMaterial({map:textures.grassTop}),
   new THREE.MeshLambertMaterial({map:textures.dirt}),
   new THREE.MeshLambertMaterial({map:textures.grassSide}),
   new THREE.MeshLambertMaterial({map:textures.grassSide})
 ];
}

function createBlocks(){
 for(let x=0;x<20;x++){
   for(let z=0;z<20;z++){
     const b = new THREE.Mesh(geo,grassMaterial());
     b.position.set(x,0,z);
     scene.add(b);
     blocks.push(b);
   }
 }
}

const player = {
 pos:new THREE.Vector3(10,2,10),
 yaw:0, pitch:0, speed: 0.1
};

const moveControls = { fwd: false, back: false, left: false, right: false };
function bindDPad(id, key) {
    const btn = document.getElementById(id);
    btn.addEventListener("touchstart", (e) => { e.preventDefault(); moveControls[key] = true; });
    btn.addEventListener("touchend", (e) => { e.preventDefault(); moveControls[key] = false; });
}
bindDPad("btn-fwd", "fwd");
bindDPad("btn-back", "back");
bindDPad("btn-left", "left");
bindDPad("btn-right", "right");

const raycaster = new THREE.Raycaster();
const center = new THREE.Vector2(0,0);
let currentHit = null;

const hitbox = new THREE.LineSegments(
 new THREE.EdgesGeometry(new THREE.BoxGeometry(1.02,1.02,1.02)),
 new THREE.LineBasicMaterial({color:0x000000, linewidth: 2})
);
hitbox.visible=false;
scene.add(hitbox);

let selectedSlot = 0;
const blockTypes = ["grass","dirt","stone"];
const hotbar = document.getElementById("hotbar");

blockTypes.forEach((b,i)=>{
 const s = document.createElement("div");
 s.className="slot"+(i===0?" active":"");
 s.textContent=b[0].toUpperCase();
 s.addEventListener("touchstart", (e)=>{
   e.preventDefault();
   selectedSlot = i;
   document.querySelectorAll(".slot").forEach(x=>x.classList.remove("active"));
   s.classList.add("active");
 });
 hotbar.appendChild(s);
});

document.getElementById("break").addEventListener("touchstart",(e)=>{
 e.preventDefault();
 if(!currentHit) return;
 scene.remove(currentHit.object);
 blocks.splice(blocks.indexOf(currentHit.object),1);
});

document.getElementById("place").addEventListener("touchstart",(e)=>{
 e.preventDefault();
 if(!currentHit) return;
 const pos = currentHit.object.position.clone().add(currentHit.face.normal);
 let mat;
 if(blockTypes[selectedSlot]=="grass") mat = grassMaterial();
 else if(blockTypes[selectedSlot]=="dirt") mat = new THREE.MeshLambertMaterial({map:textures.dirt});
 else mat = new THREE.MeshLambertMaterial({map:textures.stone});
 const b = new THREE.Mesh(geo, Array.isArray(mat)?mat:[mat,mat,mat,mat,mat,mat]);
 b.position.copy(pos);
 scene.add(b);
 blocks.push(b);
});

let looking=false,last={x:0,y:0};
renderer.domElement.addEventListener("touchstart",e=>{
 if(e.touches[0].clientX > window.innerWidth / 2) {
    looking=true; last.x=e.touches[0].clientX; last.y=e.touches[0].clientY;
 }
},{passive:false});

renderer.domElement.addEventListener("touchmove",e=>{
 if(!looking) return;
 player.yaw -= (e.touches[0].clientX-last.x)*0.005;
 player.pitch -= (e.touches[0].clientY-last.y)*0.005;
 player.pitch=Math.max(-1.5,Math.min(1.5,player.pitch));
 last.x=e.touches[0].clientX; last.y=e.touches[0].clientY;
},{passive:false});

renderer.domElement.addEventListener("touchend",()=>looking=false);

function loop(){
 let dx = 0; let dz = 0;
 const sin = Math.sin(player.yaw); const cos = Math.cos(player.yaw);

 if(moveControls.fwd){ dx -= sin * player.speed; dz -= cos * player.speed; }
 if(moveControls.back){ dx += sin * player.speed; dz += cos * player.speed; }
 if(moveControls.left){ dx -= cos * player.speed; dz += sin * player.speed; }
 if(moveControls.right){ dx += cos * player.speed; dz -= sin * player.speed; }

 player.pos.x += dx;
 player.pos.z += dz;

 camera.position.copy(player.pos);
 camera.rotation.set(player.pitch,player.yaw,0,'YXZ');
 
 raycaster.setFromCamera(center,camera);
 const hits = raycaster.intersectObjects(blocks);
 if(hits.length && hits[0].distance < 6){
   currentHit = hits[0];
   hitbox.visible=true;
   hitbox.position.copy(currentHit.object.position);
 }else{
   currentHit = null;
   hitbox.visible=false;
 }
 renderer.render(scene,camera);
 requestAnimationFrame(loop);
}
</script>
</body>
</html>
<style>#hotbar{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:8px;
  z-index:10;
}

.slot{
  width:48px;
  height:48px;
  border:2px solid #555;
  border-radius:6px;
  background-size:cover;
}

.slot.active{
  border:3px solid white;
}</style><script>// ================= INVENTARIO =================
const inventory = [
  { name:"grass", material: grassMaterial() },
  { name:"dirt", material: new THREE.MeshLambertMaterial({ map:textures.dirt }) },
  { name:"stone", material: new THREE.MeshLambertMaterial({ map:textures.stone }) }
];

let selectedSlot = 0;
const hotbar = document.getElementById("hotbar");

inventory.forEach((item,i)=>{
  const slot = document.createElement("div");
  slot.className = "slot" + (i===0 ? " active":"");

  // preview
  if(item.name==="grass") slot.style.backgroundImage=`url(${textures.grassTop.image.src})`;
  if(item.name==="dirt") slot.style.backgroundImage=`url(${textures.dirt.image.src})`;
  if(item.name==="stone") slot.style.backgroundImage=`url(${textures.stone.image.src})`;

  slot.addEventListener("touchstart",()=>{
    selectedSlot=i;
    document.querySelectorAll(".slot").forEach(s=>s.classList.remove("active"));
    slot.classList.add("active");
  });

  hotbar.appendChild(slot);
});</script>